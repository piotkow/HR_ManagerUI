<div class="container my-5 flex justify-content-center flex-wrap">
    <div class="card bg-secondary w-5 p-5">
        <div class="card-body">
            @if (userForm) {
            <form [formGroup]="userForm">
                <h6 class="form-heading text-center">User information</h6>
                <!-- Role -->
                <div class="mb-3 field-grid">
                    <div class="field col">
                        <label for="role" class="form-label fw-bold">Role <sub class="text-danger">*</sub></label>
                    <div class="input-group">
                        <p-dropdown [options]="roles" placeholder="Select a role" class="form-select" id="role" [ngClass]="{
                      'is-invalid':userForm.controls['role'].invalid && userForm.controls['role'].dirty,
                      'is-valid':userForm.controls['role'].valid
                    }">
                        </p-dropdown>
                        <span (click)="clearRole()" class="input-group-text">
                            <i class="icons8-f-close"></i>
                        </span>
                    </div>
                    </div>
                    <span *ngIf="userForm.controls['role'].invalid && userForm.controls['role'].dirty"
                        class="text-danger">
                        Role is required
                    </span>
                </div>
                <!-- First Name -->
                <div class="mb-3 field-grid">
                    <div class="field col">
                    <label for="firstName" class="form-label fw-bold">First name <sub
                            class="text-danger">*</sub></label>
                    <input type="text" pInputText formControlName="firstName" class="form-control text-base text-color surface-overlay p-2 border-1 border-solid surface-border border-round appearance-none outline-none focus:border-primary w-full" id="firstName" [ngClass]="{
                    'is-invalid':userForm.controls['firstName'].invalid && userForm.controls['firstName'].dirty,
                    'is-valid':userForm.controls['firstName'].valid
                  }">
                    <span *ngIf="userForm.controls['firstName'].invalid && userForm.controls['firstName'].dirty"
                        class="text-danger">First name is required</span>
                    </div>
                </div>
                <!-- Last Name -->
                <div class="mb-3 field-grid">
                    <div class="field col">
                    <label for="lastName" class="form-label fw-bold">Last name <sub class="text-danger">*</sub></label>
                    <input type="text" pInputText formControlName="lastName" class="form-control text-base text-color surface-overlay p-2 border-1 border-solid surface-border border-round appearance-none outline-none focus:border-primary w-full" id="lastName" [ngClass]="{
                    'is-invalid':userForm.controls['lastName'].invalid && userForm.controls['lastName'].dirty,
                    'is-valid':userForm.controls['lastName'].valid
                  }">
                    <span *ngIf="userForm.controls['lastName'].invalid && userForm.controls['lastName'].dirty"
                        class="text-danger">Last name is required</span>
                    </div>
                </div>
                <!-- Birth Date -->
                <div class="mb-3 field-grid">
                    <div class="field col">
                    <label for="dateOfBirth" class="form-label fw-bold">Date of birth <sub
                            class="text-danger">*</sub></label>
                    <input type="date" pInputText formControlName="dateOfBirth" class="form-control text-base text-color surface-overlay p-2 border-1 border-solid surface-border border-round appearance-none outline-none focus:border-primary w-full" id="dateOfBirth" [ngClass]="{
                    'is-invalid':userForm.controls['dateOfBirth'].invalid && userForm.controls['dateOfBirth'].dirty,
                    'is-valid':userForm.controls['dateOfBirth'].valid
                  }">
                    <span *ngIf="userForm.controls['dateOfBirth'].invalid && userForm.controls['dateOfBirth'].dirty"
                        class="text-danger">Date of birth is required</span>
                    </div>
                </div>
                <!-- Username -->
                <div class="mb-3 field-grid">
                    <div class="field col">
                    <label for="username" class="form-label fw-bold">Username <sub class="text-danger">*</sub></label>
                    <input type="text" pInputText [(ngModel)]="typedUsername" (keyup)="checkUsername()" formControlName="username"
                        class="form-control text-base text-color surface-overlay p-2 border-1 border-solid surface-border border-round appearance-none outline-none focus:border-primary w-full" id="username" [ngClass]="{
                               'is-invalid': userForm.controls['username'].invalid && (userForm.controls['username'].dirty || userForm.controls['username'].touched),
                               'is-valid': userForm.controls['username'].valid
                           }">
                    <span
                        *ngIf="userForm.controls['username'].hasError('required') && (userForm.controls['username'].dirty || userForm.controls['username'].touched)"
                        class="text-danger">Username is required</span>
                    <span *ngIf="userForm.controls['username'].hasError('usernameExists')" class="text-danger">
                        Username already exists
                    </span>
                    </div>
                </div>
                <!-- Password -->
                <div class="mb-3 field-grid">
                    <div class="field col">
                    <label for="password" class="form-label fw-bold">Password <sub class="text-danger">*</sub></label>
                    <input type="password" pInputText formControlName="password" class="form-control text-base text-color surface-overlay p-2 border-1 border-solid surface-border border-round appearance-none outline-none focus:border-primary w-full" id="password" [ngClass]="{
                            'is-invalid': userForm.controls['password'].invalid && userForm.controls['password'].dirty,
                            'is-valid': userForm.controls['password'].valid
                        }" />
                    <ng-container *ngIf="userForm.controls['password'].invalid && userForm.controls['password'].dirty">
                        <div *ngIf="userForm.controls['password'].hasError('required')" class="text-danger">
                            {{ passwordErrorMessages.required }}
                        </div>
                        <ng-container *ngIf="!userForm.controls['password'].hasError('required')">
                            <div class="text-danger">
                                Your password should meet the minimum requirements:
                            </div>
                            <ul>
                                <li *ngIf="userForm.controls['password'].hasError('length')" class="text-danger">
                                    {{ passwordErrorMessages.length }}
                                </li>
                                <li *ngIf="userForm.controls['password'].hasError('lowercase')" class="text-danger">
                                    {{ passwordErrorMessages.lowercase }}
                                </li>
                                <li *ngIf="userForm.controls['password'].hasError('uppercase')" class="text-danger">
                                    {{ passwordErrorMessages.uppercase }}
                                </li>
                                <li *ngIf="userForm.controls['password'].hasError('digit')" class="text-danger">
                                    {{ passwordErrorMessages.digit }}
                                </li>
                                <li *ngIf="userForm.controls['password'].hasError('symbol')" class="text-danger">
                                    {{ passwordErrorMessages.symbol }}
                                </li>
                            </ul>
                        </ng-container>
                    </ng-container>
                    </div>
                </div>

                <!-- Email -->
                <div class="mb-3 field-grid">
                    <div class="field col">
                    <label for="email" class="form-label fw-bold">Email <sub class="text-danger">*</sub></label>
                    <input type="email" pInputText formControlName="email" class="form-control text-base text-color surface-overlay p-2 border-1 border-solid surface-border border-round appearance-none outline-none focus:border-primary w-full" id="email" [ngClass]="{
                        'is-invalid': userForm.controls['email'].invalid && userForm.controls['email'].dirty,
                        'is-valid': userForm.controls['email'].valid
                    }">
                    <span *ngIf="userForm.controls['email'].hasError('required') && userForm.controls['email'].dirty"
                        class="text-danger">Email is required</span>
                    <span
                        *ngIf="userForm.controls['email'].hasError('email') && !userForm.controls['email'].hasError('required')"
                        class="text-danger">Email format is incorrect</span>
                    </div>
                </div>
                <!-- Phone Number -->
                <div class="mb-3 field-grid">
                    <div class="field col">
                    <label for="phone" class="form-label fw-bold ">Phone number <sub class="text-danger">*</sub></label>
                    <input type="text" pInputText formControlName="phone" class="form-control text-base text-color surface-overlay p-2 border-1 border-solid surface-border border-round appearance-none outline-none focus:border-primary w-full" id="phone" [ngClass]="{
                    'is-invalid':userForm.controls['phone'].invalid && userForm.controls['phone'].dirty,
                    'is-valid':userForm.controls['phone'].valid
                  }">
                    <span *ngIf="userForm.controls['phone'].invalid && userForm.controls['phone'].dirty"
                        class="text-danger">Phone number is required</span>
                    </div>
                </div>

                <!--Avatar-->
                <div class="label mb" style="color: #555d71">
                    <label for="avatar" class="form-label fw-bold">Avatar</label>
                    <div class="description d-flex align-items-center gap-2">
                        <i class="icons8-f-info" style="font-size: 1.25rem"></i>
                        <span> Only JPG, PNG and GIF files are allowed.</span>
                    </div>
                </div>

                <p-fileUpload 
                name="demo[]" 
                url="https://www.primefaces.org/cdn/api/upload.php" 
                (onUpload)="uploadAvatar($event)" 
                [multiple]="false" 
                accept="image/*" 
                [maxFileSize]="1000000">
                    <ng-template pTemplate="content">
                        <ul *ngIf="uploadedFile">
                            <li>
                                {{ uploadedFile.name }} - {{ uploadedFile.size }} bytes
                            </li>
                        </ul>
                    </ng-template>
                </p-fileUpload>
                <img *ngIf="selectedImage" [src]="selectedImage" alt="Avatar" class="mt-3 fixed-image">

                <div class="mt-3 mb-3">
                    <button *ngIf="!userId" (click)="saveUser()" class="btn btn-primary" [disabled]="userForm.invalid">
                        <i class="icons8-f-plus-math"></i>
                        Add
                    </button>
                </div>
                <div class="mb-3">
                    <button *ngIf="userId" (click)="editUser()" class="btn btn-warning">
                        <i class="icons8-f-edit"></i>
                        Edit
                    </button>
                </div>
            </form>
        }
        </div>
    </div>
</div>
